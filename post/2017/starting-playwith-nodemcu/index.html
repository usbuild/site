<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.42.1" />

  <title>å…¥æ‰‹ NodeMCU åŠåˆæ­¥ä½“éªŒ &middot; sysğŸ”±fork</title>

  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://sysfork.com/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="http://sysfork.com/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="http://sysfork.com/css/blackburn.css">

  
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  

  
  

  
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.4.0/styles/gruvbox-light.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.4.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://sysfork.com/img/favicon.ico" type="image/x-icon" />

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://sysfork.com/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://sysfork.com/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://sysfork.com/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://sysfork.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/usbuild" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/usbuild" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>å…¥æ‰‹ NodeMCU åŠåˆæ­¥ä½“éªŒ</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>21 Aug 2017, 20:14</time>
  </div>

  

  
  
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="http://sysfork.com/tags/nodemcu">nodemcu</a>
    
  </div>
  
  

</div>

  <p>æœ€è¿‘åˆ·å¾®åšçœ‹åˆ°æœ‰äººæåˆ° <a href="http://www.nodemcu.com/">NodeMCU</a>ï¼Œ ç½‘ä¸Šä¸€æŸ¥æ‰å‘ç°å…¶å®æ˜¯ç±»ä¼¼äº <a href="https://www.arduino.cc/">Arduino</a>çš„å¼€å‘æ¿ï¼Œä¸è¿‡
å®ƒä½¿ç”¨ lua ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œç›¸å¯¹äº micropython å…¶å ç”¨å†…å­˜æ›´å°ï¼Œè¯­è¨€çš„æ ¸å¿ƒåº“ä¹Ÿå¾ˆç®€å•ã€‚ åŒæ—¶ï¼ŒNodeMCU é›†æˆäº† <a href="http://espressif.com/zh-hans/products/hardware/esp8266ex/overview">ESP8266</a>
è¿™ç§å»‰ä»·çš„ WIFI èŠ¯ç‰‡ï¼Œä½¿å¾—å…¶æ”¯æŒä¸€å®šçš„ç½‘ç»œåŠŸèƒ½ã€‚å»æ·˜å®æœç´¢ä¸€ä¸‹</p>

<p><center><img src="http://sysfork.com/img/2017/nodemcu/taobao-search-nodemcu.png" width="450px"></center></p>

<p>ä»·æ ¼ä¹Ÿæ˜¯éå¸¸ä¾¿å®œã€‚æˆ‘éšä¾¿æ‰¾äº†ä¸€å®¶åº—é“ºä¹°äº†ä¸¤ä¸ªï¼Œæ€»å…±ä¸åˆ° 40 å—é’±ã€‚</p>

<p>æœ€ç»ˆåˆ°æ‰‹å°±æ˜¯è¿™ä¸ªå•¦ï¼š
<center><img src="http://sysfork.com/img/2017/nodemcu/nodemc-board.png" width="450px"></center></p>

<p>è¿™å—æ¿å­ç›´æ¥æ”¯æŒ microUSB æ¥å£ï¼Œä¸ç”¨è‡ªå·±ä½¿ç”¨ USB-TTL æ¥è¿äº†ï¼Œçœäº†ä¸å°‘éº»çƒ¦ã€‚è¿æ¥ç”µè„‘åï¼ˆæ³¨æ„æœ‰äº›USBçº¿åªæ”¯æŒå……ç”µï¼Œæˆ‘æ‰¾äº†ä¸¤æ¡çº¿éƒ½ç”¨ä¸äº†ï¼Œæ¢äº†ç¬¬ä¸‰æ ¹æ•°æ®çº¿æ‰è„¸ä¸Šï¼‰ï¼Œä¼šè‡ªåŠ¨å®‰è£…
é©±åŠ¨ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºå¤šäº†ä¸€ä¸ª COM å£ã€‚</p>

<p><center><img src="http://sysfork.com/img/2017/nodemcu/devicemanager.png" width="450px"></center></p>

<p>è¿æ¥ä¸Šç”µè„‘åç¬¬ä¸€ä»¶äº‹å°±æ˜¯åˆ·æœºï¼Œè¿™é‡Œæ˜¯å›ºä»¶çš„åœ°å€ <a href="https://github.com/nodemcu/nodemcu-firmware">https://github.com/nodemcu/nodemcu-firmware</a>ï¼Œ å½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆ·
<a href="https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html">MicroPython</a>ã€‚ç”±äºå›ºä»¶ç¼–è¯‘ç¯å¢ƒæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æœ‰çˆ±å¥½è€…åšäº†ä¸€ä¸ªåœ¨çº¿ç¼–è¯‘çš„ç½‘ç«™
<a href="https://nodemcu-build.com/">https://nodemcu-build.com/</a>ï¼Œä½ å¯ä»¥é€‰æ‹©åˆ†æ”¯å’Œæ¨¡å—ï¼Œå®ç°å®šåˆ¶ã€‚æäº¤ä»»åŠ¡åï¼Œå½“å®ƒå¼€å§‹ç¼–è¯‘å’Œç»“æŸç¼–è¯‘çš„æ—¶å€™ä¼šå‘é€é‚®ä»¶ç»™ä½ ç•™ä¸‹çš„é‚®ç®±ã€‚åŒæ—¶ï¼Œä¼šæ¨èä¸€ä¸ª
 flash å·¥å…·ï¼Œå…¶å®å°±æ˜¯ pyflasher çš„ GUI ç‰ˆï¼Œä½ å¯ä»¥ä¸‹è½½ä¸‹æ¥ä½¿ç”¨ã€‚æ¥ä¸‹æ¥å¯åŠ¨è¿™ä¸ªå·¥å…·ï¼š</p>

<p><center><img src="http://sysfork.com/img/2017/nodemcu/pyflash.png" width="450px"></center></p>

<p>ç”±äºæˆ‘ä¹°çš„è¿™ä¸ªæ¿å­˜å‚¨è¶…è¿‡4Mï¼Œæ‰€ä»¥é€‰æ‹©çš„æ˜¯ DIO æ¨¡å¼ï¼ŒåŒæ—¶ç”±äºæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥ç›´æ¥é€‰æ‹©æ¸…é™¤æ‰€æœ‰æ•°æ®ã€‚åˆ·æœºå¾ˆå¿«ï¼Œä¸åˆ°1minã€‚ä¹‹åå°±å¯ä»¥ä½¿ç”¨å•¦ã€‚</p>

<p>IDE æˆ‘é€‰æ‹©çš„æ˜¯<a href="https://esp8266.ru/esplorer">ESPlorer</a>ï¼Œå®ƒåŒæ—¶æ”¯æŒ lua å’Œ MicroPython ç¼–ç¨‹ã€‚æ‰“å¼€ä¸»ç•Œé¢åç›´æ¥ç‚¹å‡»å³ä¸Šè§’çš„ Connect å°±å¯ä»¥äº†ï¼Œç„¶åæŒ‰ä¸€ä¸‹æ¿å­ä¸Šçš„
 RST æŒ‰é’®å°±èƒ½è¿›å…¥ lua çš„ REPL ç¯å¢ƒäº†ã€‚å¯ä»¥åœ¨ä¸‹é¢è¾“å…¥ lua ä»£ç æ‰§è¡Œï¼Œå°±è·Ÿæ™®é€šçš„ lua äº¤äº’å¼ç¯å¢ƒä¸€æ ·ã€‚ä¸‹é¢æ˜¯å¦‚ä½•è¿æ¥ wifi çš„ä»£ç </p>

<pre><code class="language-lua">wifi.setmode(wifi.STATION)
wifi.sta.config({ssid=&quot;SSID_NAME&quot;, pwd=&quot;PASSWORD&quot;})
</code></pre>

<p>å…¶ä¸­ wifi æ˜¯ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œæ‰€æœ‰çš„å†…ç½®æ¨¡å—éƒ½å¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™é€‰ä¸­ï¼Œæ¨¡å—çš„ä½¿ç”¨æ–‡æ¡£ï¼š<a href="https://nodemcu.readthedocs.io">https://nodemcu.readthedocs.io</a>ã€‚ æ¯”å¦‚è¯´æƒ³è·å–æŸä¸ªç½‘å€çš„å†…å®¹ï¼š</p>

<pre><code class="language-lua">http.get(&quot;http://baidu.com&quot;, nil, function(code, data)
    print(code, data)
end)
</code></pre>

<p>NodeMCU é‡‡ç”¨äº†ä¸€ç§äº‹ä»¶è§¦å‘æ¨¡å‹ï¼Œæ‰€ä»¥å¾ˆå¤šè¿™ç§å›è°ƒå‡½æ•°ï¼Œç±»ä¼¼äº Node.jsã€‚</p>

<p>NodeMCU æä¾›äº†å¾ˆå¤š GPIO å£ï¼Œä½¿å¾—å®ƒæˆä¸º IoT å¼€å‘çš„é¦–é€‰æ–¹æ¡ˆï¼Œå¯ä»¥è¿æ¥å„ç§ä¼ æ„Ÿå™¨ã€‚æˆ‘å°è¯•äº†ä¸€ä¸‹æ¸©åº¦ä¼ æ„Ÿå™¨ DHT11 æ¨¡å—ï¼Œå•†å®¶ç›´æ¥å°è£…å¥½äº†ï¼Œä¸ç”¨è‡ªå·±å†æ¥ä¸Šæ‹‰ç”µé˜»äº†ã€‚å¦‚æœç›´æ¥é€šè¿‡ç¼–ç¨‹æ¥è¯»å–
æ¸©åº¦å’Œæ¹¿åº¦æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå¥½åœ¨å†…ç½®æ¨¡å—æä¾›äº† DHT æ¨¡å—ï¼Œåªè¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŒ…å«è¿›å»å°±å¯ä»¥ã€‚æœ€åä»£ç å¦‚ä¸‹(ä»æ–‡æ¡£æ‘˜å–çš„)ï¼Œå…¶ä¸­ 5 æ˜¯ä¿¡å·è¾“å…¥æºï¼š</p>

<pre><code class="language-lua">pin = 5
status, temp, humi, temp_dec, humi_dec = dht.read(pin)
if status == dht.OK then
    -- Integer firmware using this example
    print(string.format(&quot;DHT Temperature:%d.%03d;Humidity:%d.%03d\r\n&quot;,
          math.floor(temp),
          temp_dec,
          math.floor(humi),
          humi_dec
    ))

    -- Float firmware using this example
    print(&quot;DHT Temperature:&quot;..temp..&quot;;&quot;..&quot;Humidity:&quot;..humi)

elseif status == dht.ERROR_CHECKSUM then
    print( &quot;DHT Checksum error.&quot; )
elseif status == dht.ERROR_TIMEOUT then
    print( &quot;DHT timed out.&quot; )
end
</code></pre>

<p>é™¤äº†å°è¯• DHT11 æ¨¡å—å¤–ï¼Œè¿˜è¯•äº†ä¸€ä¸‹è¶…å£°æ³¢æ¨¡å— HC-SR04ï¼Œ è¿™ä¸ªæ˜¯é€šè¿‡å‘ Trig ç«¯è¾“å‡ºä¸€æ®µé«˜ç”µå¹³ä¿¡å·ï¼Œç„¶åé€šè¿‡ Echo ç«¯æ¥æ£€æµ‹é«˜ç”µå¹³ï¼Œé«˜ç”µå¹³çš„æŒç»­æ—¶é—´å°±æ˜¯è¶…å£°æ³¢ä¼ è¾“çš„æ—¶é—´ï¼Œç„¶åæ ¹æ®
ç©ºæ°”ä¸­çš„å£°é€Ÿå°±èƒ½è®¡ç®—å‡ºæ¥äº†ã€‚å¥½åœ¨ä¹Ÿæœ‰äººæä¾›äº†ä¸€ä¸ªå¼€æºä»£ç  <a href="https://github.com/sza2/node_hcsr04/">https://github.com/sza2/node_hcsr04/</a>ã€‚ä½†æ˜¯å®é™…ä½¿ç”¨å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚
æˆ‘ä»¬æ¥çœ‹çœ‹ä»–çš„ä»£ç ï¼š</p>

<pre><code class="language-lua">function self.echo_cb(level)
    if level == 1 then
        self.time_start = tmr.now()
        gpio.trig(self.echo, &quot;down&quot;)
    else
        self.time_end = tmr.now()
    end
end

function self.measure()
    gpio.trig(self.echo, &quot;up&quot;, self.echo_cb)
    gpio.write(self.trig, gpio.HIGH)
    tmr.delay(100)
    gpio.write(self.trig, gpio.LOW)
    tmr.delay(100000)
    if (self.time_end - self.time_start) &lt; 0 then
        return -1
    end
    return (self.time_end - self.time_start) / 5800
end
</code></pre>

<p>é€»è¾‘å¾ˆç®€å•ï¼Œå…ˆæ˜¯é€šè¿‡ç›‘å¬ä½åˆ°é«˜è½¬æ¢çš„ä¿¡å·ï¼Œè®°å½•æ—¶é—´åŒæ—¶ç›‘å¬é«˜åˆ°åœ°çš„ä¿¡å·ï¼Œè®°å½•æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å·®å€¼å°±æ˜¯è¶…å£°æ³¢çš„ä¼ è¾“æ—¶é—´ã€‚ä½†æ˜¯ç”±äºè¶…å£°æ³¢çš„é€Ÿåº¦å¾ˆå¿«ï¼Œå¾ˆæœ‰å¯èƒ½ä½ åœ¨è®¾ç½® down
äº‹ä»¶ä¹‹å‰å·²ç»è§¦å‘äº†ï¼Œå¯¼è‡´è¿Ÿè¿Ÿæ— æ³•è·å–ç»“æŸä¿¡å·ã€‚æ‰€ä»¥å¯ä»¥ç¨ä½œæ”¹åŠ¨</p>

<pre><code class="language-lua">function self.echo_cb(level)
    if level == 1 then
        self.time_start = tmr.now()
    else
        self.time_end = tmr.now()
    end
end
function self.measure()
    gpio.trig(self.echo, &quot;both&quot;, self.echo_cb)
    gpio.write(self.trig, gpio.HIGH)
    tmr.delay(100)
    gpio.write(self.trig, gpio.LOW)
    tmr.delay(100000)
    if (self.time_end - self.time_start) &lt; 0 then
        return -1
    end
    return (self.time_end - self.time_start) / 5800
end
</code></pre>

<p>ç„¶åå‘ç°éƒ¨åˆ†èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼Œä½†æ˜¯å¯¹äºçŸ­è·ç¦»çš„æµ‹é‡è¿˜æ˜¯ä¼šä¸¢å¤±ç»“æŸä¿¡å·ï¼ŒçŒœæƒ³å¯èƒ½æ˜¯åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­äº‹ä»¶åˆ°æ¥ï¼Œç»“æœæ²¡èƒ½æ¥å¾—åŠå¤„ç†ï¼Œæ‰€ä»¥åªèƒ½é‡‡å–æ¯”è¾ƒè€åœŸçš„æ–¹æ¡ˆäº†ï¼Œä¸ä½¿ç”¨äº‹ä»¶é©±åŠ¨ï¼Œç›´æ¥è¯»</p>

<pre><code class="language-lua">function self.measure()
    gpio.write(self.trig, gpio.HIGH)
    tmr.delay(100)
    gpio.write(self.trig, gpio.LOW)
    gpio.mode(self.echo, gpio.INPUT)
    gpio.write(self.echo, gpio.LOW)
    local start_time, end_time
    local gread = gpio.read
    local tnow = tmr.now
    local echo = self.echo
    local wdclr = tmr.wdclr
    while gread(echo) == 1 do
        start_time = tnow()
        wdclr()
    end
    while gread(echo) == 0 do
        end_time = tnow()
        wdclr()
    end
    return (end_time - start_time) / 5800
end
</code></pre>

<p>æœ€ç»ˆçš„æ•ˆæœè¿˜ä¸é”™ï¼Œå¯¹äºå‡ å˜ç±³çš„è·ç¦»ä¹Ÿèƒ½æœ‰å¾ˆå¥½çš„åˆ†è¾¨ç‡ã€‚</p>

<p>æ€»çš„æ¥è¯´ï¼Œ NodeMCU çš„å¯ç©æ€§éå¸¸å¼ºï¼Œæ¯”å¦‚è¯´å¯ä»¥é€šè¿‡ç½‘ç»œå’Œç»§ç”µå™¨å®ç°å®¶åº­ç”µå™¨å¼€å…³çš„æ§åˆ¶å•¦ï¼Œç®€ç›´å°±æ˜¯ç¡¬ä»¶ç‰ˆçš„ IFTTTï¼Œç›¸æ¯”äºæ ‘è“æ´¾ï¼Œä»·æ ¼å¤Ÿä¾¿å®œï¼Œç®€ç›´å°±æ˜¯æŠ˜è…¾æ™ºèƒ½å®¶åº­çš„ç¥å™¨ã€‚</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://sysfork.com/post/2017/use-git-bisect-to-debug/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://sysfork.com/post/2017/use-git-bisect-to-debug/">ä½¿ç”¨ git bisect è¿›è¡Œdebug</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'sysfork';
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  
  
</div>

</div>
</div>
<script src="http://sysfork.com/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19710645-12', 'auto');
  ga('send', 'pageview');

</script>


</script>
</body>
</html>

